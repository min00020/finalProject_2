<div 
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	xmlns:th="http://www.thymeleaf.org"
	layout:decorate="@{/layout/member/mainTemplate.html}"
	layout:fragment="content"	  
>
	<section>
		<div class="container" style="width:1000px;">
			<h3 style="font-weight:bold; color:#3e6ce3;margin-left:20px;">질문 작성하기</h3>
			<hr>
			<!-- 질문 작성폼 시작 -->
			<form name="questionWrite">
				<div style="width:900px; margin:0 auto; ">
					<div class="d-flex justify-content-between">	
						<div style="width:48%;">
							<label for="topic" style="font-weight : bold;">토픽</label>
							<p style="font-size:14px; margin-bottom:8px;">질문과 관련된 토픽을 선택해주세요. </p>
		                    <select id="topic" name="topic" class="form-select" style="border:1px solid #ccc;">
		                    	<option value="" selected disabled hidden>토픽을 선택해주세요</option>
		                    	<option value="H001">기술</option>
		                    	<option value="H002">사이드 프로젝트</option>
		                    </select>
						</div>
						<div style="width:48%;">
							<label for="point" style="font-weight:bold;">포인트</label>
							<span style="margin-left:5px; font-size:12px;">보유 </span>
							<span style="font-size:12px;color:#3e6ce3; font-weight:bold;">1000원</span>
							<p style="font-size:14px; margin-bottom:8px;">답변자에게 지급할 포인트 금액을 입력해주세요. </p>
		                   <!-- 	<input type="text" class="form-control" value="0"> -->
		                   	<div class="chae_input-container" style="width:100%;">
							    <input id="point" name="point" type="text" class="form-control" value="0" style="color:#3e6ce3;">
							    <button class="chae_pointBtn">전액사용</button>
							</div>
						</div>
					</div>
					<!-- 토픽, 포인트 끝 -->
					<br>
					<div>
						<div>
							<label for="title" style="font-weight:bold; margin-bottom:8px;">제목</label>
							<input id="title" name="title" type="text" class="form-control" placeholder="제목을 입력해주세요">
							<br>
						</div>
						<label for="tags" style="font-weight:bold; margin-bottom:8px;">태그</label>
						<input id="tag" name="tag" type="text" class="form-control" placeholder="태그를 입력해주세요">
						<br>
						
						<!-- <label for="contents" style="font-weight:bold; margin-bottom:8px;">질문 내용</label>
						<textarea id="contents" name="contents" class="form-control" style="height:300px;"></textarea>
						<br> -->
						
						<label for="editor" style="font-weight:bold; margin-bottom:8px;">질문 내용</label>
						<div id="editor" name="editor" style="height:300px;"></div>
						<br>
					</div>
					
					
					<div style="float: right;margin-bottom:10px;">
						<button type="button" class="btn text-white" style="background-color:#989daa; margin:10px;">취소</button>
						<button type="button" class="btn text-white" style="background-color:#3e6ce3;" onclick="sendQuestion()">등록</button>
					</div>
				</div>
				<!-- 질문 작성폼 끝 -->
			</form>
		</div>
		<!-- end of container -->
	</section>
</div>

<!-- text editor -->
<script>
let html = null;
const editor = CKEDITOR.ClassicEditor.create(document.getElementById("editor"), {
  toolbar: {
    items: [
      //'exportPDF', 'exportWord', '|',
      'findAndReplace', 'selectAll', '|',
      'heading', '|',
      'bold', 'italic', 'strikethrough', 'underline', 'code', 'subscript', 'superscript', 'removeFormat', '|',
      'bulletedList', 'numberedList', 'todoList', '|',
      'outdent', 'indent', '|',
      'undo', 'redo', '|',
      'fontSize', 'fontFamily', 'fontColor', 'fontBackgroundColor', 'highlight', '|',
      'alignment', '|',
      'link', 'insertImage', 'blockQuote', 'insertTable', 'mediaEmbed', 'codeBlock', 'htmlEmbed', '|',
      'specialCharacters', 'horizontalLine', 'pageBreak', '|',
      'textPartLanguage', '|',
      'sourceEditing'
    ],
    shouldNotGroupWhenFull: true
  },
  list: {
    properties: {
      styles: true,
      startIndex: true,
      reversed: true
    }
  },
  heading: {
    options: [
      { model: 'paragraph', title: 'Paragraph', class: 'ck-heading_paragraph' },
      { model: 'heading1', view: 'h1', title: 'Heading 1', class: 'ck-heading_heading1' },
      { model: 'heading2', view: 'h2', title: 'Heading 2', class: 'ck-heading_heading2' },
      { model: 'heading3', view: 'h3', title: 'Heading 3', class: 'ck-heading_heading3' },
      { model: 'heading4', view: 'h4', title: 'Heading 4', class: 'ck-heading_heading4' },
      { model: 'heading5', view: 'h5', title: 'Heading 5', class: 'ck-heading_heading5' },
      { model: 'heading6', view: 'h6', title: 'Heading 6', class: 'ck-heading_heading6' }
    ]
  },
  placeholder: 'Welcome to CKEditor 5!',
  fontFamily: {
    options: [
      'default',
      'Arial, Helvetica, sans-serif',
      'Courier New, Courier, monospace',
      'Georgia, serif',
      'Lucida Sans Unicode, Lucida Grande, sans-serif',
      'Tahoma, Geneva, sans-serif',
      'Times New Roman, Times, serif',
      'Trebuchet MS, Helvetica, sans-serif',
      'Verdana, Geneva, sans-serif'
    ],
    supportAllValues: true
  },
  fontSize: {
    options: [10, 12, 14, 'default', 18, 20, 22],
    supportAllValues: true
  },
  htmlSupport: {
    allow: [
      {
        name: /.*/,
        attributes: true,
        classes: true,
        styles: true
      }
    ]
  },
  htmlEmbed: {
    showPreviews: true
  },
  link: {
    decorators: {
      addTargetToExternalLinks: true,
      defaultProtocol: 'https://',
      toggleDownloadable: {
        mode: 'manual',
        label: 'Downloadable',
        attributes: {
          download: 'file'
        }
      }
    }
  },
  mention: {
    feeds: [
      {
        marker: '@',
        feed: [
          '@apple', '@bears', '@brownie', '@cake', '@cake', '@candy', '@canes', '@chocolate', '@cookie', '@cotton', '@cream',
          '@cupcake', '@danish', '@donut', '@dragée', '@fruitcake', '@gingerbread', '@gummi', '@ice', '@jelly-o',
          '@liquorice', '@macaroon', '@marzipan', '@oat', '@pie', '@plum', '@pudding', '@sesame', '@snaps', '@soufflé',
          '@sugar', '@sweet', '@topping', '@wafer'
        ],
        minimumCharacters: 1
      }
    ]
  },
  removePlugins: [
    'ExportPdf',
    'ExportWord',
    'CKBox',
    'CKFinder',
    'EasyImage',
    'RealTimeCollaborativeComments',
    'RealTimeCollaborativeTrackChanges',
    'RealTimeCollaborativeRevisionHistory',
    'PresenceList',
    'Comments',
    'TrackChanges',
    'TrackChangesData',
    'RevisionHistory',
    'Pagination',
    'WProofreader',
    'MathType'
  ]
}).then( newEditor => {
    html = newEditor;
})
.catch( error => {
  console.error( error );
});


</script>

<script th:inline="javascript">
let csrfPara = $('meta[name="csrfPara"]').attr("content");
let csrfToken = $('meta[name="csrf"]').attr("content");


function sendQuestion(){
	console.log('test',[[${session.member.memberNo}]]);
	const formData = new FormData(document.questionWrite);
	
	formData.append(csrfPara, csrfToken);
	formData.append("memberNo", [[${session.member.memberNo}]]);
	formData.append("contents", html.getData());

	
	$.ajax('/question/write', {
		type : "POST",
		data : formData,
		contentType : false,
		processData : false 	
	})
	.done(res => {
		showSuccessAlert('등록성공');
		console.log(res);
    	/* window.location.href = "/gitLinkPage?id=" + $('input[name="userid"]').val(); */
    })
    .fail(err => {
    	console.log(err);
    	showWarningAlert('등록실패');
    })
	
}

</script>

