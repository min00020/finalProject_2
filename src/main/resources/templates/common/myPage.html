<div xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	xmlns:th="http://www.thymeleaf.org"
	layout:decorate="@{/layout/member/mainTemplate.html}"
	layout:fragment="content">
	<div class="d-flex">
		<section class="d-flex" id="tae-section">
			<aside class="tae-aside">
				<div class="flex-shrink-0">
					<!-- 프로필-->
					<div class="card justify-content-center align-items-center" id="tae-card">
						<!-- 프사 -->
						<div class="box-1">
							<th:block th:if="${memberInfo.profileImage} == null">
								<img class="tae-profile-1" th:src="commonResource/default_profile.jpg"
									 alt="profile">
							</th:block>
							<th:block th:unless="${memberInfo.profileImage} == null">
								<img class="tae-profile-1 mx-auto d-block"
									th:src="|upload/profile/${memberInfo.profileImage}|" alt="...">
							</th:block>
						</div>
						<!-- grade image -->
						<div class="card-body">
							<h6 class="tae-card-text"
								th:text="${memberInfo.nickname}">\</h6>
							<h6 class="card-text" th:text="${memberInfo.email}">\</h6>
							<img class="tae-gradeImage"
								th:src="|commonResource/gradeimage/${memberInfo.gradeName}.png|"
								logo=""> <span class="card-text"
								th:text="${memberInfo.gradeName}">\</span>
							<h6 class="card-text" th:text="|${#numbers.formatInteger(memberInfo.accumActivityPoint, 0, 'COMMA')} P|">\</h6>

						</div>
					</div>

					<!-- summary -->

					<div class="card container" id="tae-container3">
						<h5 id="tae-sum-h5">SUMMARY</h5>
						<!-- 정산요청 div -->
						<div class="tae-container4">
							<div class="row" id="tae-row">
								<div class="tae-box1 col-1">
									<img class="img1" src="commonResource/icon/point.png">
								</div>
								<div class="tae-box2 col-2" id="tae-box2">
									<h6 class="tae-h6">POINT</h6>
									<h6 id="pointMypage" class="card-text"
										th:text="|${#numbers.formatInteger(memberInfo.acoTotal, 0, 'COMMA')} P|"></h6>
								</div>
								<div class="col-1" id="tae-col-1">
									<!-- 모달버튼 -->
									<button type="button" class="btn btn-modal"  id="tae-modal-btn"
										data-bs-toggle="modal" data-bs-target="#point">
										<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
											viewBox="0 0 24 24" fill="none" stroke="currentColor"
											stroke-width="2" stroke-linecap="round"
											stroke-linejoin="round" class="feather feather-chevron-right">
										<polyline points="9 18 15 12 9 6"></polyline></svg>
									</button>
									<!-- 모달시작 -->
									<div class="modal fade" id="point" tabindex="-1" role="dialog"
										aria-labelledby="pointModalLabel" aria-hidden="true">
										<div class="modal-dialog modal-xl" role="document">
											<div class="modal-content">
												<div class="modal-header" styp>

													<h3 class="modal-title" id="pointModalLabel"
														style="font-weight: bold;">
														<img src="commonResource/icon/point.png"
															style="width: 70px; height: 70px;">포인트뱅크
													</h3>

												</div>
												<div class="modal-body">
													<!-- 포인트뱅크모달영역 -->
													<div style="height:430px;">
														<div class="d-flex">
															<div class="point-image" style="width:350px;">
																<img src="/commonResource/taefolder/pointacc.png" style="width:350px;">
																<h4 class="tae-h4-1">누적 애코포인트 현황</h4>
																<h3 id="totalPointMypage" th:text="|${#numbers.formatInteger(memberInfo.acoTotal, 0, 'COMMA')} P|"></h3>
															</div>
																<div class="point-acc" style="hegiht:700px;">
																	<div class="point-acc-1">
																		<h4 class="tae-h4-2">애코포인트 정산</h4>
																		<br>
																		<p class="tae-p-1">* 최소 5,000P 부터 정산가능하며 포인트샵에서 충전한 포인트는 정산 불가</p>
																		<br>
																		<div class="input-group mb-3" style="width:600px;height:50px;">
																			<input type="text" id="accumPointMypage" class="form-control" name="accPoint" th:placeholder="|정산가능포인트 ${#numbers.formatInteger(memberInfo.availableAccumPoint, 0, 'COMMA')} P|" aria-label="Recipient's username" aria-describedby="button-addon2">
																			<button class="btn btn-outline-secondary" id="accountApprove" type="button" data-bs-toggle="modal" data-bs-target="#accountList">정산요청</button>
																		</div>
																	</div>
																	<div class="point-acc-1">
																		<h4 class="tae-h4-2">활동점수 포인트 전환</h4>
																		<br>
																		<p class="tae-p-1">* 5,000점 이상부터 1,000점 단위로 전환가능</p>
																		<br>
																		<div class="input-group mb-3" style="width:600px;height:50px;">
																			<input type="text" class="form-control" id="activityMypage" name="resPoint" th:placeholder="|가용 활동점수 ${#numbers.formatInteger(memberInfo.availableActivityPoint, 0, 'COMMA')} 점|"  aria-label="Recipient's username" aria-describedby="button-addon2">
																			<button class="btn btn-outline-secondary" type="button" id="changepoint">환전요청</button>
																		</div>
																	</div>
																</div>
														</div>
													</div>
														<div id="activityList">
															<div>
																<h4 style="padding-left:30px;font-weight:bold;">포인트 정산 및 환전 내역</h4><hr>
																	<ul class="scroll type3" id="accumList">
																		<li class="activity1" th:each="pol:${pointList}">
																		<span style="font-weight:bold;font-size:large;" th:text="${pol.historyType}"></span>
																		<span class="increase-point" th:if="${pol.accType} == '0'" th:text="|+ ${#numbers.formatInteger(pol.incDecPoint, 0, 'COMMA')}P |"></span>
																		<span class="decrease-point" th:unless="${pol.accType} == '0'" th:text="| ${#numbers.formatInteger(pol.incDecPoint, 0, 'COMMA')}P |"></span>
																		<br>
																		<span class="tae_date" th:text="${#dates.format(pol.historyDate, 'yy-MM-dd')}">[[${pol.historyDate}]]</span>
																		<hr>
																		</li>
																	</ul>
																
															</div>
														</div>
												</div>
												<div class="modal-footer">
													<button type="button" class="btn btn-secondary"
														data-bs-dismiss="modal">Close</button>
												</div>
											</div>
										</div>
									</div>
									<!-- 모달 끝 -->
									
								</div>
							</div>
						</div>
						<!-- 활동점수 -->
						<div class="tae-container4">
							<div class="row" id="tae-row">
								<div class="tae-box1 col-1">
									<img class="img1" src="commonResource/icon/activity.png">
								</div>
								<div class="tae-box2 col-2" id="tae-box2">
									<h6 class="tae-h6">내 활동 관리</h6>
									<h6 class="card-text">활동/등급 관리</h6>
								</div>
								<div class="col-1" id="tae-col-1">
									<!-- 모달버튼 -->
									<button type="button" class="btn btn-modal" id="tae-modal-btn"
										data-bs-toggle="modal" data-bs-target="#activity">
										<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
											viewBox="0 0 24 24" fill="none" stroke="currentColor"
											stroke-width="2" stroke-linecap="round"
											stroke-linejoin="round" class="feather feather-chevron-right">
										<polyline points="9 18 15 12 9 6"></polyline></svg>
									</button>
									<!-- 모달시작 -->
									<div class="modal fade" id="activity" tabindex="-1"
										role="dialog" aria-labelledby="activityModalLabel"
										aria-hidden="true">
										<div class="modal-dialog modal-xl" role="document">
											<div class="modal-content">
												<div class="modal-header">
													<h3 class="modal-title" id="activityModalLabel"
														style="font-weight: bold;">
														<img src="commonResource/icon/activity.png"
															style="width: 70px; height: 70px;">내활동관리
													</h3>
												</div>
												<div class="modal-body">
													<div class="d-flex" style="hegiht:700px;">
														<div class="activity-image" style="width:350px;hegiht:700px;padding-left:30px;">
															<img th:src="|commonResource/gradeimage/${memberInfo.gradeName}.png|" style="width:300px;padding:left:50px;">
															<h4 style="text-align:center;font-weight:bold;">내 등급</h4>
														</div>
														<div class="grade" style="hegiht:700px;padding-left:80px;">
															<div class="point-acc-1" style="width:750px;hegiht:450px;margin-top:40px;">
																<div class="grade">
																	<div class="gradeinfo" style="float:left;">
																		<img class="gradeimage" src="commonResource/gradeimage/루키.png">
																	</div>
																	<div class="gradecontent" style="display:inline-block;padding-left:20px;" >
																		<h5 class="grade-h5" style="font-weight:bold;padding-top:9px;">LV1. 루키</h5>
																		<br>
																		<p class="grade-p" style="margin-top:-30px;">가입한 모든 회원</p>
																	</div>
																</div>
																<div class="grade">
																	<div class="gradeinfo">
																		<img class="gradeimage" src="commonResource/gradeimage/브론즈.png">
																	</div>
																	<div class="gradecontent">
																		<h5 class="grade-h5">LV2. 브론즈</h5>
																		<br>
																		<p class="grade-p">작성된 질의글 및 답변이 20개 이상이면서 누적 활동점수 30,000점 이상인 회원</p>
																	</div>
																</div>
																<div class="grade">
																	<div class="gradeinfo">
																		<img class="gradeimage" src="commonResource/gradeimage/실버.png">
																	</div>
																	<div class="gradecontent">
																		<h5 class="grade-h5">LV3. 실버</h5>
																		<br>
																		<p class="grade-p">작성된 질의글 및 답변이 100개 이상이면서 누적 활동점수 200,000점 이상인 회원</p>
																	</div>																
																</div>
																<div class="grade">
																	<div class="gradeinfo">
																		<img class="gradeimage" src="commonResource/gradeimage/골드.png">
																	</div>
																	<div class="gradecontent">
																		<h5 class="grade-h5">LV4. 골드</h5>
																		<br>
																		<p class="grade-p">작성된 질의글 및 답변이 500개 이상이면서 누적 활동점수 500,000점 이상인 회원</p>
																	</div>	
																</div>
																<div class="grade">
																	<div class="gradeinfo">
																		<img class="gradeimage"  src="commonResource/gradeimage/다이아몬드.png">
																	</div>
																	<div class="gradecontent">
																		<h5 class="grade-h5">LV5. 다이아몬드</h5>
																		<br>
																		<p class="grade-p">작성된 질의글 및 답변이 1000개 이상이면서 누적 활동점수 1,000,000점 이상인 회원</p>
																	</div>	
																</div>
															</div>
															
														</div>
													</div>
													<div id="activityList">
															<div>
																<h4 class="tae-h4-3">내 활동 내역</h4><hr>
																	<ul class="scroll type3" style="overflow-y: scroll; height: 300px; overflow-x: hidden;">
																		<li class="activity1" th:each="acp:${activityList}">
																		<span style="font-weight:bold;font-size:large;" th:if="${acp.incDecActivityPoint} >= 0" th:text="|${acp.historyType}로 인하여 활동점수가 증감되었습니다.|"></span>
																		<span style="font-weight:bold;font-size:large;" th:unless="${acp.incDecActivityPoint} >= 0" th:text="|${acp.historyType}로 인하여 활동점수가 차감되었습니다.  |"></span>
																		<span class="increase-point" th:if="${acp.incDecActivityPoint} >= '0'" th:text="|+ ${#numbers.formatInteger(acp.incDecActivityPoint, 0, 'COMMA')}점 |"></span>
																		<span class="decrease-point" th:unless="${acp.incDecActivityPoint} >= '0'" th:text="| ${#numbers.formatInteger(acp.incDecActivityPoint, 0, 'COMMA')}점  |"></span>
																		<br>
																		<span class="tae_date" th:text="${#dates.format(acp.activityPointDate, 'yy-MM-dd')}">[[${acp.activityPointDate}]]</span>
																		<hr>
																		</li>
																		
																	</ul>
																
															</div>
													</div>
												</div>
												<div class="modal-footer">
													<button type="button" class="btn btn-secondary"
														data-bs-dismiss="modal">Close</button>
												</div>
											</div>
										</div>
									</div>
									<!-- 모달 끝 -->
									<!-- 정산 계좌 Modal -->
									
										<div th:if="${#lists.size(accountList)} == 0">
											<div class="modal fade" id="accountList" tabindex="-1" aria-labelledby="accountApproveLabel" aria-hidden="true">
											  <div class="modal-dialog">
											    <div class="modal-content">
											      <div class="modal-header">
											        <h3 class="modal-title fs-5" id="accountApproveLabel">정산 받을 계좌를 선택해주세요</h3>
											        <button type="button" class="btn-noaccount" data-bs-dismiss="modal" aria-label="계좌가 없어요 〉"></button>
											      </div>
											      <div class="modal-body">
											       	<h5 style="font-weight:bold;color:#54545d;">은행선택</h5>
												      	<div class="bankcard">
												       		<p style="text-align:center;color:#979da9;">"현재 등록된 계좌가 없습니다."</p>
												       	</div>
											      </div>
											      <div class="modal-footer">
											        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
											        <button type="button" class="btn btn-primary">정산요청</button>
											      </div>
											    </div>
											  </div>
											</div>
										</div>
										<div th:unless="${#lists.size(accountList)} == 0">
											<div class="modal fade" id="accountList" tabindex="-1" aria-labelledby="accountApproveLabel" aria-hidden="true">
											  <div class="modal-dialog">
											    <div class="modal-content">
											      <div class="modal-header">
											        <h3 class="modal-title fs-5" id="accountApproveLabel">정산 받을 계좌를 선택해주세요</h3>
											      </div>
											      <div class="modal-body">
											        <button type="button" class="btn-noaccount" data-bs-dismiss="modal" aria-label="계좌가 없어요 〉"></button>
											       	<h5 style="font-weight:bold;color:#54545d;">은행선택</h5>
												       <div class="bank" th:id="${acc.accountNo}" th:each="acc:${accountList}"  >
												       		<button type="button" style="border:0;" th:onclick="choiceAccount([[${acc.accountNo}]])">
												       			<img class="tae-bank-1" th:src="|commonResource/bankImage/${acc.bankName}.png|">
															</button>											       		
												       		<p th:text="${acc.bankName}" style="float:left;">/</p>
												       </div>
											      </div>
											      <div class="modal-footer">
											        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
											        <button type="button" class="btn btn-primary">정산요청</button>
											      </div>
											    </div>
											  </div>
											</div>
										</div>
								</div>
							</div>
						</div>

						<!-- 회원정보수정 -->
						<div class="tae-container4">
							<div class="row" id="tae-row">
								<div class="tae-box1 col-1">
									<img class="img1" src="commonResource/icon/modifyinfo.png">
								</div>
								<div class="tae-box2 col-2" id="tae-box2">
									<h6 class="tae-h6">회원정보수정</h6>
									<h6 class="card-text">정보,비밀번호</h6>
								</div>
								<div class="col-1" id="tae-col-1">
									<!-- 모달버튼 -->
									<button type="button" class="btn btn-modal"  id="tae-modal-btn"
										data-bs-toggle="modal" data-bs-target="#point">
										<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
											viewBox="0 0 24 24" fill="none" stroke="currentColor"
											stroke-width="2" stroke-linecap="round"
											stroke-linejoin="round" class="feather feather-chevron-right">
										<polyline points="9 18 15 12 9 6"></polyline></svg>
									</button>
									<!-- 모달시작 -->
									<div class="modal fade" id="modify" tabindex="-1" role="dialog"
										aria-labelledby="modifyModalLabel" aria-hidden="true">
										<div class="modal-dialog modal-xl" role="document">
											<div class="modal-content">
												<div class="modal-header">
													<h3 class="modal-title" id="modifyModalLabel"
														style="font-weight: bold;">
														<img src="/commonResource/icon/modifyinfo.png"
															style="width: 70px; height: 70px;">회원정보수정
													</h3>
												</div>
												<!-- 회원정보수정모달영역 전민교가 연동하기로함 -->
												<div class="modal-body">
													
												</div>
												<div class="modal-footer">
													<button type="button" class="btn btn-secondary"
														data-bs-dismiss="modal">Close</button>
													<button type="button" class="btn btn-primary">Save
														changes</button>
												</div>
											</div>
										</div>
									</div>
									<!-- 모달 끝 -->
								</div>
								
							</div>
						</div>
						<!-- 위에까지 회원정보 수정 끝 -->
					</div>
				</div>
			</aside>
		</section>
		<!-- 메인바디영역 -->
		<!-- mypage1 -->
		<div class="container" id="tae-container-3">
			<div class="container" id="tae-container-1">
				<div class="card" id="myTabContent">
					<ul class="nav nav-tabs" id="myTab" role="tablist">
						<li class="nav-item" role="presentation">
							<button class="nav-link" id="profile-tab" data-bs-toggle="tab"
							data-bs-target="#profile-tab-pane" type="button" role="tab"
							aria-controls="profile-tab-pane" aria-selected="true"
							style="width: 380px;">내가 참여한 프로젝트</button>
						</li>
						<li class="nav-item" role="presentation">
							<button class="nav-link active" id="tae-profile-tab-2"
							data-bs-toggle="tab" data-bs-target="#home-tab-pane"
							type="button" role="tab" aria-controls="home-tab-pane"
							aria-selected="false" style="width: 380px;" onclick="location.href='/myPage2'">내 질답 통계</button>
						</li>

					</ul>
					
					
					
					
					
					<div class="card d-flex">
						<div class="card">
							<div class="card-body" id="card-1">
								<h5 class="card-title">🏃‍♀️참여프로젝트 목록</h5>
								<h6 class="card-subtitle mb-2 text-body-secondary">Card
									subtitle</h6>
								<p class="card-text">Some quick example text to build on the
									card title and make up the bulk of the card's content.</p>
								<a href="#" class="card-link">Card link</a> <a href="#"
									class="card-link">Another link</a>
							</div>
						</div>
					</div>
					<div>

						<div class="card d-flex" id="tae-card-2">
							<div class="card-body" id="tae-card-1">
								<h5 style="text-align: center; font-weight: bold;">내 관심주제</h5>
								<ul class="tab-ul">
									<li th:text="${memberInfo.topicHashtag}"></li>
								</ul>
							</div>
						</div>
						<div class="card d-flex" id="tae-card-2">
							<div class="card-body" id="tae-card-1">
								<h5 style="margin-bottom: -8px; font-weight: bold;">
									😉 이모티콘 구매내역
									<button type="button" class="btn btn-modal" id="tae-modal-btn"
										onclick="goEmoShop()" data-bs-toggle="modal"
										data-bs-target="#bookmark"
										>
										더보기
										<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
											viewBox="0 0 24 24" fill="none" stroke="currentColor"
											stroke-width="2" stroke-linecap="round"
											stroke-linejoin="round" class="feather feather-chevron-right">
										<polyline points="9 18 15 12 9 6"></polyline></svg>
									</button>
								</h5>
									<hr>
								<ul class="tab-ul">
									<li th:each="emo:${emoInfo}">[[ ${emo.emoName} ]] 
										<span class="tae-ul-list" th:text="|구매날짜 ${#dates.format(emo.emoBuydate, 'yyyy-MM-dd')}|">
										[[${emo.emoBuydate}]] </span>
										<hr>
									</li>
								</ul>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<script type="text/javascript" th:inline="javascript">
let choiceAccountObj = null;
function choiceAccount(accountObj){
	if(choiceAccountObj != null  || choiceAccountObj == accountObj){
		$('#'+ choiceAccountObj).css("border", "");
		if(choiceAccountObj == accountObj) {
			choiceAccountObj = null;
			return;
		}
	}
	choiceAccountObj = accountObj
	
	$('#'+ accountObj).css("border", "1px solid skyblue");
	
}


let csrfPara = $('meta[name="csrfPara"]').attr("content");
let csrfToken = $('meta[name="csrf"]').attr("content");
	const memberno = [[${session.member.memberNo}]]
	function goEmoShop(){
		location.href = '/emoMain';
	}
	
	
	//활동점수환전
	$('#changepoint').on('click', pointUpdateAjax);
	
		function pointUpdateAjax(event){
			if (!validation()) return;
			let resPoint = $('input[name="resPoint"]');
			let obj = {
				resPoint : resPoint.val(),
			}
			//post 에서만 사용
			obj[csrfPara] = csrfToken;
			
			$.ajax('/updateMemberPoint',{
				type:"POST",
				data : obj				
			}).done(result =>{
				showSuccessAlert('정상적으로 환전되었습니다.');
				
				function dateFormat(date) {
					let dateFormat2 = date.getFullYear() +
						'-' + ( (date.getMonth()+1) < 9 ? "0" + (date.getMonth()+1) : (date.getMonth()+1) )+
						'-' + ( (date.getDate()) < 9 ? "0" + (date.getDate()) : (date.getDate()) );
					return dateFormat2;
				}

				const toDate = dateFormat(new Date());
				const commaIncDecPoint = Number(resPoint.val()).toLocaleString();
				
				const commaActivityPoint = Number(result.memberInfo.availableActivityPoint).toLocaleString();
				const commaAccummPoint = Number(result.memberInfo.availableAccumPoint).toLocaleString();
				const commaTotalPoint = Number(result.memberInfo.acoTotal).toLocaleString();
				const liString = `
									<li class="activity1">
										<span style="font-weight:bold;font-size:large;">포인트 전환</span>
										<span class="increase-point">+ ${commaIncDecPoint}P</span>
										<br>
										<span class="tae_date">${toDate}</span>
										<hr>
									</li>`;
				
				$('#activityMypage').val('');
				
				
				const accumList = $('#accumList');
				accumList.prepend(liString);
				
				$('#pointMypage').text(commaTotalPoint);
				$('#totalPointMypage').text(commaTotalPoint);
				$('#accumPointMypage').attr("placeholder", "정산 가능포인트 " + commaAccummPoint + " P");
				$('#activityMypage').attr("placeholder", "가용 활동점수 " + commaActivityPoint + " 점");
				
			}).fail(err => console.log(err));
		}
			
		function validation(){
			let resPoint = $('input[name="resPoint"]');
			const numPoint = Number(resPoint.val());
			if(numPoint < 5000 || (numPoint % 1000) != 0){
				showWarningAlert("5,000점 이상부터 1,000점 단위로 환전 가능합니다");
				return false;
			}
			return true;
		}	
</script>
