<div xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	xmlns:th="http://www.thymeleaf.org"
	layout:decorate="@{/layout/member/mainTemplate.html}"
	layout:fragment="content">
	<!-- header tab -->
	<div class="publishingStatus">
		<hr id="tae-hr">
			<th:block th:if="${sideInfo.publishingStatus} == 'Q001'">	
				<a id="a-1" th:href="|/sideProjectList/Q001/?pageNo=1|">ëª¨ì§‘ì¤‘</a><span>
				<a id="a-2" th:href="|/sideProjectList/Q002/?pageNo=1|">í˜‘ì—…ì¤‘</a></span>
			</th:block>
			<th:block th:unless="${sideInfo.publishingStatus} == 'Q001'">	
				<a id="a-2" th:href="|/sideProjectList/Q001/?pageNo=1|">ëª¨ì§‘ì¤‘</a><span>
				<a id="a-1" th:href="|/sideProjectList/Q002/?pageNo=1|">í˜‘ì—…ì¤‘</a></span>
			</th:block>
		<hr id="tae-hr">	
	</div>
	<!-- contents -->
	<div class="conetents">
				<th:block th:if="${sideInfo.publishingStatus} == 'Q001'" >
				<h6 class="tae-side-h6-1">ëª¨ì§‘ì¤‘</h6>
				</th:block>
				<th:block th:unless="${sideInfo.publishingStatus} == 'Q001'" >
				<h6 class="tae-side-h6-2">í˜‘ì—…ì¤‘</h6>
				</th:block>
					<h5 style="font-weight:bolder;">[[ ${sideInfo.title }]]</h5>
					<br>
					<p style="font-weight:bold;">[[${sideInfo.projectOutline}]]</p>
					<br>
					<p style="color:#979da9;float:left;">ê¸°ê°„ | [[${sideInfo.devPeriod}]]ì¼  ëª¨ì§‘ì¸ì› [[${sideInfo.recruitPersonnel}]]ëª…</p>
				    <span>
					<p style="color:#979da9;margin-top:-10px;float:right;">ì¡°íšŒìˆ˜ [[ ${sideInfo.viewCnt} ]]íšŒ  ëŒ“ê¸€ìˆ˜ [[ ${sideInfo.replyCnt} ]]ê°œ</p></span> 
					<br>
					<th:block>
						<div class="tae-side-btn1" style="margin-top:20px;">
							<th:block th:if="${isCheckMember} == 1 and ${sideInfo.publishingStatus} == 'Q001'">
								<div class="d-grid gap-2 d-md-flex justify-content-md-end">
								  	<button class="btn text-white" id="modifyContent" type="button" style="background-color:#aebfec;">ê¸€ìˆ˜ì •</button>
								  	<button class="btn text-white" id="deleteProject" type="button" style="background-color:#80a9e8;">ê¸€ì‚­ì œ</button>
								  	<button class="btn btn-primary" id="changeStatusButton" type="button" style="background-color:#0C5FEC;">í˜‘ì—…ì‹œì‘</button>
								</div>
							</th:block>
						</div>
					</th:block>
				<hr id="tae-hr">
				<div class="container" id="tae-container-5">
				<h5 style="font-weight:bold;">í”„ë¡œê·¸ë¨ ì†Œê°œ</h5>
				<p style="font-weight:bold;">[[${sideInfo.content}]]</p>
				</div>	
		<p style="font-weight:bold;">ì‘ì„±ì ê¹ƒ ë³´ëŸ¬ê°€ê¸° ğŸ’» <a class="tae-gitaddress" th:href="@{sideInfo.gitAddress}" th:text="${sideInfo.gitAddress}"></a></p>
	</div>
	<!--/* ëŒ“ê¸€ì˜ì—­ */-->
	<div class="w-100 mb-3 clearfix">
		<div>
			<div class="d-flex justify-content-center">
				<textarea id="commentInput" rows="5" class="mt-4" placeholder="ì—¬ëŸ¬ë¶„ì˜ ìƒê°ì„ ëŒ“ê¸€ë¡œ ììœ ë¡­ê²Œ í‘œí˜„í•´ì£¼ì„¸ìš”." style="width:90%;"></textarea>
			</div>
			<div class="d-flex justify-content-end my-2 gap-1" style="width:95%;">
				<button class="btn" type="button" style="color:white; background-color:#3e6ce3" onclick="registReply()">ëŒ“ê¸€ë“±ë¡</button>
				<button class="btn" type="button" style="color:white; background-color:#80a9e8" data-bs-toggle="modal" data-bs-target="#emoModal">ì´ëª¨í‹°ì½˜ ë“±ë¡</button>
			</div>
		</div>
		<br>
		<!--/*ëŒ“ê¸€ ë°˜ë³µêµ¬ê°„  */-->
		<div class="mt-1 w-100 mb-5" th:each="reply : ${replyList}">
			<div>
				<!--/*ëŒ“ê¸€(ë¶€ëª¨) í—¤ë”êµ¬ê°„  */-->
				<div class="mx-5 d-flex justify-content-between" style="width:90%;">
					<div>
						<!--/* í”„ë¡œí•„ì´ë¯¸ì§€ê°€ nullì´ë¼ë©´ */-->
						<img th:if="${reply.value[0].parentImage} == null" style="width:5%;" th:src="|/commonResource/default_profile.jpg|" alt="profile" />
						<img th:unless="${reply.value[0].parentImage} == null" style="width:5%;" th:src="|upload/profile/${reply.value[0].parentImage}|" alt="profile" />
						<span>[[${reply.value[0].parentNickname}]]</span>
						<small th:text="${#dates.format(reply.value[0].parentWriteDate, 'yyyy-MM-dd HH:mm:ss')}"></small>
					</div>
					<div>
						<button type="button" class="btn"><img style="width:25px;" th:src="|/commonResource/icon/best.png|" alt="recommend"/></button>
						[[${reply.value[0].parentRecCnt}]]
						<button type="button" class="btn mb-1"><img style="width:25px;" th:src="|/commonResource/icon/alert.png|" alt="alert"/></button>
					</div>
				</div>
				<!--/*ëŒ“ê¸€ ë‚´ìš©êµ¬ê°„  */-->
				<div style="width:90%; margin-left:93px;">
					<p style="margin-bottom:0px;">[[${reply.value[0].parentComment}]]</p>
				</div>
								
				<div style="width:90%; margin-left:80px;">
					<button type="button" class="btn" th:id="|nested${reply.key}|" th:onclick="|openNestedTextarea('nested${reply.key}','nestedComment${reply.key}')|">ë‹µê¸€ë‹¬ê¸°</button>
				</div>
				<!--/* ë‹µê¸€ì˜ì—­ */-->
				<div style="display:none;" th:id="|nestedComment${reply.key}|">
					<div class="d-flex justify-content-center">
						<textarea th:id="|nestedTextarea${reply.key}|" rows="5" class="mt-4" placeholder="ì—¬ëŸ¬ë¶„ì˜ ìƒê°ì„ ëŒ“ê¸€ë¡œ ììœ ë¡­ê²Œ í‘œí˜„í•´ì£¼ì„¸ìš”." style="width:90%;"></textarea>
					</div>
					<div class="d-flex justify-content-end my-2 gap-1" style="width:95%;">
						<button class="btn" type="button" style="color:white; background-color:#3e6ce3" th:onclick="|registNestedReply(${reply.key})|">ë‹µê¸€ë“±ë¡</button>
						<button class="btn" type="button" style="color:white; background-color:#80a9e8" data-bs-toggle="modal" data-bs-target="#emoModal">ì´ëª¨í‹°ì½˜ ë“±ë¡</button>
					</div>
				</div>
			</div>
			<!-- /* ëŒ€ëŒ“ê¸€(ìì‹) */-->
			<th:block th:if="${reply.value[0].childReplyNo} != null">
				<div class="ms-4" th:each="innerReply : ${replyList[reply.key]}">
					<!--/*ëŒ“ê¸€ í—¤ë”êµ¬ê°„  */-->
					<div class="mx-5 d-flex justify-content-between" style="width:90%;">
						<div>
							â””<img th:if="${innerReply.childImage} == null" style="width:5%;" th:src="|/commonResource/default_profile.jpg|" alt="profile" />
							<img th:unless="${innerReply.childImage} == null" style="width:5%;" th:src="|upload/profile/${innerReply.childImage}|" alt="profile" />
							<span>[[${innerReply.childNickname}]]</span>
							<small th:text="${#dates.format(innerReply.childWriteDate, 'yyyy-MM-dd HH:mm:ss')}"></small>
						</div>
						<div>
							<button type="button" class="btn"><img style="width:25px;" th:src="|/commonResource/icon/best.png|" alt="recommend"/></button>
							[[${innerReply.childRecCnt}]]
							<button type="button" class="btn mb-1"><img style="width:25px;" th:src="|/commonResource/icon/alert.png|" alt="alert"/></button>
						</div>
					</div>
					<!--/*ëŒ“ê¸€ ë‚´ìš©êµ¬ê°„  */-->
					<div style="width:90%; margin-left:108px;">
						<p style="margin-bottom:0px;">[[${innerReply.childComment}]]</p>
					</div>
				</div>
			</th:block>
		</div>
		<!--/*ëŒ“ê¸€ ë°˜ë³µêµ¬ê°„ ë— */-->
	</div>
	<!--/* ëŒ“ê¸€ì˜ì—­ ë— */-->
	
	
	
	
	
</div>
<script type="text/javascript" th:inline="javascript">

let csrfPara = $('meta[name="csrfPara"]').attr("content");
let csrfToken = $('meta[name="csrf"]').attr("content");

const memberNo = [[${session.member.memberNo}]]
const status = 'Q002';
const bno = [[${sideInfo.sideBoardNo}]];

function openNestedTextarea(btnId,commentId) {
	if($('#' + btnId).text() == "ë‹µê¸€ë‹¬ê¸°") {
		$('#' + btnId).text('ë‹µê¸€ë‹«ê¸°');
		$('#' + commentId).css('display','block');
	}
	else {
		$('#' + btnId).text('ë‹µê¸€ë‹¬ê¸°');
		$('#' + commentId).css('display','none');
	}
	
}

function registReply() {
	// ë¡œê·¸ì¸í–ˆëŠ”ì§€ í•­ìƒ ì²´í¬. ë¬¸ì˜ ê²Œì‹œíŒì€ ë¡œê·¸ì¸ í•´ì•¼ ì§„ì…ê°€ëŠ¥í•˜ê¸´ í•˜ì§€ë§Œ ê·¸ë˜ë„ ì²´í¬í•´ì¤€ë‹¤.
	if(typeof memberNo == "undefined" || memberNo == null) {
		showFailAlert("ë¡œê·¸ì¸ í›„ ì§„í–‰í•´ì£¼ì„¸ìš”.");
		return;
	}
	
	const comment = $('#commentInput').val();
	if(comment == null || comment == '') {
		showWarningAlert('ëŒ“ê¸€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
		return;
	}
	
	// ì´ëª¨í‹°ì½˜ì¸ì§€ ì²´í¬?
	const boardType = 'N006';
	const object = {
		boardType : boardType,
		boardNo : bno,
		replyBody : comment,
		isEmoticon : "0",
		replyPno : null
	};
	
	$.ajax('/reply', {
		type: "POST",
		data: object,
		beforeSend : function(xhr){
			xhr.setRequestHeader("X-CSRF-Token", csrfToken); 
		},
	})
	.done(res => {
		document.location.href = document.location.href;
	})
	.fail(err => {
		showFailAlert("ì‹¤íŒ¨. ë‹¤ì‹œì‹œë„í•´ì£¼ì„¸ìš”.");
		console.log(err);
	})
}

function registNestedReply(replyPno) {
	// ë¡œê·¸ì¸í–ˆëŠ”ì§€ í•­ìƒ ì²´í¬. ë¬¸ì˜ ê²Œì‹œíŒì€ ë¡œê·¸ì¸ í•´ì•¼ ì§„ì…ê°€ëŠ¥í•˜ê¸´ í•˜ì§€ë§Œ ê·¸ë˜ë„ ì²´í¬í•´ì¤€ë‹¤.
	if(typeof memberNo == "undefined" || memberNo == null) {
		showFailAlert("ë¡œê·¸ì¸ í›„ ì§„í–‰í•´ì£¼ì„¸ìš”.");
		return;
	}
	
	const textareaId = '#nestedTextarea' + replyPno;
	const text = $(textareaId).val();
	if(text == null || text == '') {
		showWarningAlert('ëŒ“ê¸€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
		return;
	}
	
	// ì´ëª¨í‹°ì½˜ì¸ì§€ ì²´í¬?
	const boardType = 'N006';
	const object = {
		boardType : boardType,
		boardNo : bno,
		replyBody : text,
		isEmoticon : "0",
		replyPno : replyPno
	};
	
	$.ajax('/reply', {
		type: "POST",
		data: object,
		beforeSend : function(xhr){
			xhr.setRequestHeader("X-CSRF-Token", csrfToken); 
		},
	})
	.done(res => {
		document.location.href = document.location.href;
	})
	.fail(err => {
		showFailAlert("ì‹¤íŒ¨. ë‹¤ì‹œì‹œë„í•´ì£¼ì„¸ìš”.");
		console.log(err);
	})
}



 $(document).ready(function() {
	$('#changeStatusButton').click(function() {
		
		
		let obj = {		
				  status : status,
				  bno : bno
				   }
		obj[csrfPara] = csrfToken;
		$.ajax('/updateStatus',{
			type: "POST",
			data: obj
			}).done(result =>{
				console.log(result);
				showSuccessAlert("í˜‘ì—…ì‹œì‘ìœ¼ë¡œ ìƒíƒœê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.");
				window.location.reload();
		}).fail(err => console.log(err));
	})
});

//ê²Œì‹œê¸€ ìˆ˜ì •í¼ ì´ë™
$(document).ready(function(){
	$('#modifyContent').click(function(){
		window.location.href= "/insertSideProject?bno=" + bno ;
	})
});

//ê²Œì‹œê¸€ ì‚­ì œ
$(document).ready(function(){
	$('#deleteProject').click(function(){
		let obj = {
				bno : bno
		}
		obj[csrfPara] = csrfToken;
		
		$.ajax('/deleteAjax', {
			type: "get",
			data : obj
		}).done(result => {
			console.log(result);
			showSuccessAlert("ê²Œì‹œê¸€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
			window.location.href="/sideProjectList/Q001/?pageNo=1";
		}).fail(err => {
			console.log(err);
			showWarningAlert("ì‚­ì œ ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤.");
		});
	});
});

</script>