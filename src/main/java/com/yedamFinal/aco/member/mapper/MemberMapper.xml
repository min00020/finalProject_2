<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yedamFinal.aco.member.mapper.MemberMapper">
<select id="getMember" resultType="MemberVO">
	SELECT  MID,
		PASS,
		NAME,
		PHONE,
		'ROLE_' || upper(RESPONSIBILITY) RESPONSIBILITY
		FROM MEMBER
		WHERE MID = #{mid}
		
</select>

<select id="selectCheckDuplicateId" resultType="MemberVO">
	SELECT id
		FROM member
		WHERE ID = #{id}
</select>
<select id="selectLogin" resultType="MemberVO">
	SELECT MEMBER_NO,ID,PASSWORD,EMAIL,PHONE_NUM,NAME,NICKNAME,PROFILE_IMAGE,TOPIC_HASHTAG,
	PERMISSION,LEAVE_DATE,ACCUM_ACTIVITY_POINT,AVAILABLE_ACTIVITY_POINT,ACO_MONEY,ACO_POINT,MEMBER_LEVEL,
	SNS_TYPE,BAN_TYPE,BAN_DATE,GIT_TOKEN
		FROM member
		WHERE ID = #{id}
</select>
<select id="selectCheckDuplicateEmail" resultType="MemberVO">
	SELECT email,id
		FROM member
		WHERE email = #{email}
</select>

<select id="selectVerifyAuthNumber" resultType="String">
	SELECT AUTH_CODE
		FROM AUTH_PHONE
		WHERE AUTH_CODE = #{authNum} AND PHONE_NUM = #{phoneNum}  
</select>

<insert id="insertAuthNumber">
	INSERT INTO AUTH_PHONE (
		AUTH_PHONE_NO, AUTH_CODE, EXPIRE_DATE, PHONE_NUM
	)
	VALUES ( AUTH_PHONE_SEQ.NEXTVAL, #{authNum}, SYSDATE + INTERVAL '3' MINUTE, #{phoneNum})
</insert>
  
<select id="selectAuthNumber" resultType="String">
	SELECT PHONE_NUM
		FROM AUTH_PHONE
		WHERE PHONE_NUM = #{phoneNum}
</select>
  
<delete id="deleteAuthNumber" parameterType="String"> 
	DELETE FROM AUTH_PHONE WHERE PHONE_NUM = #{phoneNum} 
</delete>

<update id="updateMemberGitToken">
	UPDATE MEMBER SET GIT_TOKEN = '${gitToken}' WHERE id = #{id}
</update>

<select id="selectTagList" resultType="com.yedamFinal.aco.common.TagVO">
	SELECT TAG_NAME
		FROM TAG
</select>

<insert id="insertMember" parameterType="MemberVO">
	INSERT INTO MEMBER (
		MEMBER_NO,ID,PASSWORD,EMAIL,
		PHONE_NUM,NAME,NICKNAME,PROFILE_IMAGE,TOPIC_HASHTAG,PERMISSION,LEAVE_DATE,ACCUM_ACTIVITY_POINT,
		AVAILABLE_ACTIVITY_POINT,ACO_MONEY,ACO_POINT,MEMBER_LEVEL,SNS_TYPE,BAN_TYPE,BAN_DATE
	)
	VALUES(
		member_seq.NEXTVAL,#{id},#{password},#{email},#{phoneNum},#{name},#{nickname},#{profileImage},
		#{topicHashtag},#{permission},null,#{accumActivityPoint},#{availableActivityPoint},#{acoMoney},#{acoPoint},#{memberLevel},
		null,null,null
	)
</insert>
<insert id="insertFindAccountEmailLink" parameterType="FindAccountEmailLinkVO">
	INSERT INTO FINDACCOUNT_EMAIL_LINK(
		ACCESS_KEY,
		MEMBER_ID,
		EXPIRE_DATE
	)
	VALUES(
		#{accessKey},
		#{memberId},
		#{expireDate}
	)
</insert>

<select id="selectFindAccountEmailInfo" resultType="FindAccountEmailLinkVO">
	SELECT ACCESS_KEY, MEMBER_ID, EXPIRE_DATE
		FROM FINDACCOUNT_EMAIL_LINK
		WHERE ACCESS_KEY = #{accessKey} 
</select>

<update id="updateMemberPassword">
	UPDATE 
		MEMBER SET PASSWORD = #{password} WHERE id = #{id}
</update>

<delete id="deleteFindAccountEmailLink" parameterType="String"> 
	DELETE FROM FINDACCOUNT_EMAIL_LINK WHERE ACCESS_KEY = #{accessKey} 
</delete>

</mapper>